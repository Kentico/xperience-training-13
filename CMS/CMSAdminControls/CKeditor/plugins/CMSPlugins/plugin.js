var CMSPlugin={window:this.window,requires:["iframedialog","fakeobjects"],currentEditor:null,lang:["en"],regNumber:/^\d+(?:\.\d+)?$/,regFlashFilename:/\.swf(?:$|\?)/i,selection:null,selectedElement:null,selectionBookmarks:null,cssifyLength:function(e){return CMSPlugin.regNumber.test(e)?e+"px":e},createFakeControl:function(e,t){if(null===e)return null;var i=null,n=e.attributes.type,a=n?n.toLowerCase():"unknown";switch(a){case"youtubevideo":(i=t.createFakeParserElement(e,"cke_youtube","object",!0)).attributes.cms_youtube="true",i.attributes.cms_disable_media="true";break;case"flash":case"media":"flash"===this.getMediaType(e,t)||"flash"===a?(i=t.createFakeParserElement(e,"cke_flash","object",!0)).attributes.cms_media="true":(i=t.createFakeParserElement(e,"cke_media","video",!0)).attributes.cms_media="true";break;case"mediafilecontrol":(i=t.createFakeParserElement(e,"cke_old_media","object",!0)).attributes.cms_media="true";break;case"image":e.attributes.width&&0<parseInt(e.attributes.width,10)&&e.attributes.height&&0<parseInt(e.attributes.height,10)||(l=this.getElementObject(e))&&((!e.attributes.width||parseInt(e.attributes.width,10)<=0)&&(!e.attributes.height||parseInt(e.attributes.height,10)<=0)?(e.attributes.width=l.originalwidth,e.attributes.height=l.originalheight):!e.attributes.height||parseInt(e.attributes.height,10)<=0?e.attributes.height=Math.round(e.attributes.width/(parseFloat(l.originalwidth)/l.originalheight)):(!e.attributes.width||parseInt(e.attributes.width,10)<=0)&&(e.attributes.width=Math.round(e.attributes.height/(parseFloat(l.originalheight)/l.originalwidth)))),(i=t.createFakeParserElement(e,"cke_image","object",!0)).attributes.cms_media="true";var r=this.getImageUrl(e,t);r&&(i.attributes.src=r);break;case"widget":var l=this.getElementObject(e);(i=t.createFakeParserElement(e,"cke_widget","object",!0)).attributes.cms_disable_media="true",i.attributes.cke_widget="true",l.image_guid&&(o=i.attributes.style||"",i.attributes.style=o+"background-image:url("+t.config.ApplicationPath+"CMSPages/GetMetaFile.aspx?fileguid="+l.image_guid+"&maxsidesize=32);"),l.widget_displayname&&(l=l.widget_displayname.replace(/\+/g," "),i.attributes.title=decodeURIComponent(l));break;default:(i=t.createFakeParserElement(e,"cke_inlinecontrol","object",!1)).attributes.cms_disable_media="true"}i.attributes.cms_inline="true",i.attributes.alt="";var o=i.attributes.style||"",s=e.attributes.width,n=e.attributes.height;return"widget"!=a&&(i.attributes.title="",void 0!==s&&(o=i.attributes.style=o+"width:"+this.cssifyLength(s)+";"),void 0!==n&&(o=i.attributes.style=o+"height:"+this.cssifyLength(n)+";")),i},getNodeList:function(e){return new CKEDITOR.dom.nodeList(e)},getElementObject:function(e){var t,i,n,a={};if(e)if(e._)for(n=0;n<e.children.length;n++)t=e.children[n].attributes.name,i=e.children[n].attributes.value,a[t]=i;else for(n=0;n<e.children.length;n++)t=e.children[n].getAttribute("name"),i=e.children[n].getAttribute("value"),a[t]=i;return a},getCurrentEditor:function(){return null!==this.currentEditor?this.currentEditor:null!==CKEDITOR.currentInstance?CKEDITOR.currentInstance:null},getImageUrl:function(e,t){t=t||this.getCurrentEditor();var i=null,e=CMSPlugin.getElementObject(e);return e.url&&0===(i=e.url).indexOf("~/")&&(i=i.replace("~/",t.config.ApplicationPath)),i},getMediaType:function(e){var t=this.getElementObject(e);return t.cms_type?t.cms_type.toLowerCase():t.ext&&".swf"===t.ext.toLowerCase()||CMSPlugin.isFlashEmbed(e)?"flash":"audiovideo"},isFlashEmbed:function(e){e=e.attributes;return"application/x-shockwave-flash"==e.type||"flash"==e.type||CMSPlugin.regFlashFilename.test(e.src||"")},initCss:function(e){var t="background-position: center center;background-repeat: no-repeat;border: 1px solid #CCC;width: 80px;height: 80px;";CKEDITOR.addCss("img.cke_media { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertImageOrMedia_bg.png")+");"+t+"}"),CKEDITOR.addCss("img.cke_flash { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertFlash_bg.png")+");"+t+"}"),CKEDITOR.addCss("img.cke_old_media { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertImageOrMediaOld_bg.png")+");"+t+"}")},openWidget:function(e,t,i,n,a){var r=(this.currentEditor=e).getSelection().getSelectedElement();t=e.config.IsLiveSite?e.config.ApplicationPath+"CMSModules/Widgets/LiveDialogs/"+t:e.config.ApplicationPath+"CMSModules/Widgets/Dialogs/"+t,r&&r.hasAttribute("cms_inline")&&(r=e.restoreRealElement(r),"widget"!==(r=this.getInline(r.$)).cms_type||null!==i&&i!==r.name||(r=e.config.CurrentAliasPath||"",t=e.config.ApplicationPath+(e.config.IsLiveSite?"CMSModules/Widgets/LiveDialogs/WidgetProperties.aspx":"CMSModules/Widgets/Dialogs/WidgetProperties.aspx"),t+="?inline=true&aliaspath="+r,n=900,a=650)),CMSPlugin.openModalDialog(t,i,n,a)},pluginInsertMacro:function(e){var t="InsertMacro",i="";e.config.ResolverName&&(i="resolver="+e.config.ResolverName),e.config.CurrentDocumentID&&(i&&(i+="&"),i+="documentid="+e.config.CurrentDocumentID),e.config.CurrentCulture&&(i&&(i+="&"),i+="culture="+e.config.CurrentCulture);var n={exec:function(e){e=(CMSPlugin.currentEditor=e).config.ApplicationPath+"CMSAdminControls/UI/Macros/Dialogs/Default.aspx?"+i;CMSPlugin.openModalDialog(e,"insertMacro",1024,660)}},a={label:e.lang.CMSPlugins.InsertMacro.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,a),e.addCommand(t,n)},pluginKeyPress:function(e){e.on("instanceReady",function(e){function t(e){return e.ctrlKey&&e.altKey}function i(e){if(!window.disableShortcuts){if(window.HtmlEditor)return window.HtmlEditor.keyPressed(e);if(null!==window.parent&&window.parent.HtmlEditor)return window.parent.HtmlEditor.keyPressed(e)}return 1}function n(e){var t=e.data,e=t.$;return t.key=t.getKey(),t.ctrlKey=e.ctrlKey,t.altKey=e.altKey,t.shiftKey=e.shiftKey,t}function a(e){e=n(e),t(e)||i(e)}function r(e){e=n(e),t(e)&&i(e)}e.editor.document.on("keydown",a),e.editor.document.on("keyup",r),e.editor.on("mode",function(e){e=e.editor;"source"!==e.mode&&(e.document.on("keydown",a),e.document.on("keyup",r))})})},pluginInsertImageOrMedia:function(e){var n="InsertImageOrMedia",t={exec:function(e){var t=window.unescape(e.config.MediaDialogWidth),i=window.unescape(e.config.MediaDialogHeight);CMSPlugin.currentEditor=e,CMSPlugin.openModalDialog(e.config.MediaDialogURL,"imageormedia",t,i)}},i={label:e.lang.CMSPlugins.InsertImageOrMedia.button,command:n,icon:e.config.CMSPluginUrl+"images/"+n+".png"},a={imageormedia:{label:e.lang.CMSPlugins.InsertImageOrMedia.menu,command:n,group:n,icon:e.config.CMSPluginUrl+"images/"+n+".png"}};e.addCommand(n,t),e.ui.addButton(n,i),e.on("doubleclick",function(e){var t=e.data.element;if(e.editor.config.removeButtons)for(var i in e.editor.config.removeButtons)if("InsertImageOrMedia"===e.editor.config.removeButtons[i])return void e.cancel();!t.is("img")||"true"!==t.getAttribute("cms_media")&&t.data("cke-realelement")||(e.editor.execCommand(n),e.cancel())},null,null,1),e.addMenuItems&&(e.addMenuGroup(n),e.addMenuItems(a)),e.contextMenu&&e.contextMenu.addListener(function(e){if(e&&e.is("img")&&"cke_anchor"!=e.getAttribute("class")&&"flash"!=e.data("cke-real-element-type")&&("true"==e.getAttribute("cms_media")||"true"!=e.getAttribute("cms_disable_media")))return{imageormedia:CKEDITOR.TRISTATE_OFF}}),e.on("toHtml",function(e){var t=e.data.dataValue,n=e.editor.config.AppendToImagePath;void 0!==n&&0<n.length&&!function e(t){t.children&&t.children.forEach(e);{var i;"img"==t.name&&void 0!==t.attributes.src&&-1===t.attributes.src.indexOf("data:image")&&(-1==(i=t.attributes.src).indexOf("?")&&(i+="?"),i+="&"+n,t.attributes.src=i)}}(t)})},pluginInsertLink:function(n){var a="InsertLink",e={exec:function(e){var t=window.unescape(e.config.LinkDialogWidth),i=window.unescape(e.config.LinkDialogHeight);CMSPlugin.currentEditor=e,CMSPlugin.openModalDialog(e.config.LinkDialogURL,"imageormedia",t,i)}},t={label:n.lang.CMSPlugins.InsertLink.button,command:a,icon:n.config.CMSPluginUrl+"images/"+a+".png"},i={insertLink:{label:n.lang.CMSPlugins.InsertLink.menu,command:a,group:a,icon:n.config.CMSPluginUrl+"images/"+a+".png"}};n.addCommand(a,e,1),n.ui.addButton(a,t),n.on("doubleclick",function(e){var t;try{t=CKEDITOR.plugins.link.getSelectedLink(n)||e.data.element}catch(e){}if(e.editor.config.removeButtons)for(var i in e.editor.config.removeButtons)if("InsertLink"===e.editor.config.removeButtons[i])return void e.cancel();t&&(t.isReadOnly()||"Disabled"==e.editor.config.toolbar?e.stop():t.is("a")?t.getAttribute("name")&&!t.getAttribute("href")?e.data.dialog="anchor":(e.editor.execCommand(a),e.cancel()):t.is("img")&&"anchor"==t.data("cke-real-element-type")&&(e.data.dialog="anchor"))},null,null,1),n.addMenuItems&&(n.addMenuGroup(a),n.addMenuItems(i)),n.contextMenu&&n.contextMenu.addListener(function(e){if(!e||e.isReadOnly())return null;var t=e.is("img")&&"anchor"==e.data("cke-real-element-type");if(!t){if(!(e=CKEDITOR.plugins.link.getSelectedLink(n)))return null;t=e.getAttribute("name")&&!e.getAttribute("href")}return t?void 0:{insertLink:CKEDITOR.TRISTATE_OFF}})},pluginQuicklyInsertMedia:function(l){var o="QuicklyInsertImage",e={exec:function(e){CMSPlugin.currentEditor=e,CMSPlugin.saveFocus(e)}};l.addCommand(o,e),l.ui.addButton(o,{label:l.lang.CMSPlugins.QuicklyInsertImage.button,icon:l.config.CMSPluginUrl+"images/"+o+".png",onRender:function(){l.config.qimId||(l.config.qimId=[]),l.config.qimId.push(this._.id),l.on("instanceReady",function(){for(window.InsertImageOrMedia=function(e,t,i,n,a){CMSPlugin.insert(a)},r=0;r<l.config.qimId.length;r++){var e=l.config.qimId[r],t=document.getElementById(e);if(null!==t&&!t.QIM_set)if(t.QIM_set=!0,function(e){if(e){var t=e.match(/(?:formGuid=)([a-z\d-]+)/i),i=e.match(/(?:documentid=)([\d]+)/i),e=e.match(/(?:parentid=)([\d]+)/i);if(t&&e&&/^[a-f\d]{8}-[a-f\d]{4}-[a-f\d]{4}-[a-f\d]{4}-[a-f\d]{12}$/i.test(t[1])&&0<=parseInt(e[1],10))return 1;if(i&&0<=parseInt(i[1],10))return 1}}(this.config.QuickInsertURL)&&!window.disableQim){t.className+=" CMS_QIM",$cmsj(t).mouseenter(function(){CMSPlugin.currentEditor=l,CMSPlugin.saveFocus(l)}),t.onmousemove=function(){CMSPlugin.currentEditor=l};for(var i,n,a=t.getElementsByTagName("span"),r=0;r<a.length;r++)-1<a[r].className.indexOf("cke_button_icon")&&(i=a[r]);void 0!==i&&(i.style.position="relative",i.style.background="",(n=document.createElement("div")).className="InnerDiv",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.display="inline-block",n.innerHTML='<img src="'+l.config.CMSPluginUrl+"images/"+o+'.png" style="width:16px; height:16px;" />',i.appendChild(n),(n=document.createElement("div")).className="UploaderDiv",n.style.position="absolute",n.style.top="0px",n.style.width="16px",n.style.height="16px",n.style.visibility="visible",n.style.opacity="1",n.innerHTML='<iframe name="QuickInsertImage" src="'+l.config.QuickInsertURL+"&containerid="+e+'" frameborder="0" marginWidth="0" marginHeight="0" scrolling="no" border="0" style="width:16px; height:16px; overflow:hidden;" allowtransparency="true" ></iframe>',i.appendChild(n),(n=document.createElement("div")).className="LoadingDiv",n.style.position="absolute",n.style.opacity="1",n.style.display="none",n.style.top="0px",n.style.left="0px",n.innerHTML='<img src="'+l.config.ApplicationPath+'CMSPages/GetResource.ashx?image=Design/Preloaders/preload16.gif" style="width:16px; height:16px;" />',i.appendChild(n),(n=document.createElement("script")).type="text/javascript",n.src=l.config.ApplicationPath+"CMSModules/Content/Controls/Attachments/DirectFileUploader/DirectFileUploader.js",t.appendChild(n))}else t.parentNode.removeChild(t)}})}}),l.on("mode",function(){if(l.config.qimId)for(var e=0;e<l.config.qimId.length;e++){var t=l.config.qimId[e],i=document.getElementById(t);i&&(t=i.getElementsByTagName("iframe"),"source"==l.mode?(i.className+=" cke_button_disabled",t&&1===t.length&&(t[0].style.display="none")):(i.className=i.className.replace(/\s+cke_button_disabled/gi,""),t&&1===t.length&&(t[0].style.display="")))}})},pluginForumButtons:function(e){var t="InsertQuote",i={label:e.lang.CMSPlugins.InsertQuote.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},n="InsertImage",a={exec:function(e){var t=prompt(e.lang.CMSPlugins.InsertImage.prompturl,"http://");t&&e.insertHtml("[img]"+t+"[/img]")}},r={label:e.lang.CMSPlugins.InsertImage.button,command:n,icon:e.config.CMSPluginUrl+"images/"+n+".png"},l="InsertUrl",o={exec:function(e){var t,i=prompt(e.lang.CMSPlugins.InsertUrl.prompturl,"http://");i&&(t=prompt(e.lang.CMSPlugins.InsertUrl.promptdesc,""),e.insertHtml("[url="+i+"]"+t+"[/url]"))}},s={label:e.lang.CMSPlugins.InsertUrl.button,command:l,icon:e.config.CMSPluginUrl+"images/"+l+".png"};e.ui.addButton(t,i),e.addCommand(t,{exec:function(e){e.insertHtml("[quote=][/quote]")}}),e.ui.addButton(n,r),e.addCommand(n,a),e.ui.addButton(l,s),e.addCommand(l,o)},initMaximalization:function(n){n.on("maximize",function(e){var t,i=e.data;n.config.sharedSpaces&&i==CKEDITOR.TRISTATE_ON&&(-1<new CKEDITOR.dom.element(document.body).getCustomData("maximize_saved_styles").class.indexOf("cms-bootstrap")&&(document.body.className+=" cms-bootstrap"),e=(t=$cmsj("#"+n.config.sharedSpaces.top)).offset().top+t.outerHeight(),n.container.getChild(1).setStyle("top",e+"px"),i=CKEDITOR.document.getWindow().getViewPaneSize(),t=$cmsj("#"+n.config.sharedSpaces.bottom),t=i.height-e-t.outerHeight(),n.resize(i.width,t,null,!0))})},initPopupOpener:function(e){e.popup=function(e,t,i,n){CMSPlugin.openModalDialog(e,"CKEditorPopup",t,i,n)}},initContextMenu:function(e){var t={Image:"image",Link:"link",Unlink:"unlink",Flash:"flash",Table:"table"},i=e.config.toolbar instanceof Array?e.config.toolbar:e.config["toolbar_"+e.config.toolbar];if(void 0!==i){for(var n,a=0;a<i.length;a++){var r=i[a];if(r)for(var l=0;l<r.length;l++){var o=r[l];t[o]&&delete t[o]}}for(n in t)delete e._.menuItems[t[n]]}},initSelection:function(e){e.on("beforeCommandExec",function(e){CMSPlugin.saveFocus(e.editor)})},initDataProcesor:function(n){var e=n.dataProcessor,e=e&&e.dataFilter;e&&e.addRules({elements:{video:function(e){return CMSPlugin.createFakeControl(e,n)},"cke:object":function(e){if(e.attributes.codetype&&"cmsinlinecontrol"==e.attributes.codetype.toLowerCase())return CMSPlugin.createFakeControl(e,n);var t=e.attributes;if(t.classid&&String(t.classid).toLowerCase()||CMSPlugin.isFlashEmbed(e))return e.attributes.type="flash",CMSPlugin.createFakeControl(e,n);for(var i=0;i<e.children.length;i++)if("cke:embed"==e.children[i].name)return CMSPlugin.isFlashEmbed(e.children[i])?(e.attributes.type="flash",CMSPlugin.createFakeControl(e,n)):null;return null},"cke:embed":function(e){var t=null;return CMSPlugin.isFlashEmbed(e)&&(e.attributes.type="flash",t=CMSPlugin.createFakeControl(e,n)),t}}},3)},getInline:function(e,t){var i={};if(e){var n=e.getAttribute("type"),a=e.getAttribute("width"),r=e.getAttribute("height");n&&("media"==n.toLowerCase()&&(n=this.getMediaType(e)),i.cms_type=n);var l,o=this.getPropertyPrefix(n);if("OBJECT"===e.nodeName&&e.childNodes){a&&(i[o+"width"]=a),r&&(i[o+"height"]=r);for(var s=e.childNodes.length,u=0;u<s;u++){var c=e.childNodes[u],g=c.getAttribute("name"),c=c.getAttribute("value");g&&(i[o+g]=c,o+g==="flash_movie"&&(i.flash_url=c))}}"VIDEO"===e.nodeName&&(a&&(i[o+"width"]=a),r&&(i[o+"height"]=r),i[o+"loop"]=e.hasAttribute("loop"),i[o+"autoplay"]=e.hasAttribute("autoplay"),i[o+"controls"]=e.hasAttribute("controls"),r=e.querySelector("source"),i[o+"url"]=r&&r.getAttribute("src"));try{!(e=CKEDITOR.dom.element.get(t))||(l=e.getAscendant("a",!0))&&(i[o+"link"]=l.getAttribute("data-cke-saved-href")||l.getAttribute("href"),i[o+"target"]=l.getAttribute("target"))}catch(e){}}return i},getPropertyPrefix:function(e){var t="";switch(e.toLowerCase()){case"youtubevideo":t="youtube_";break;case"image":t="img_";break;case"audiovideo":t="av_";break;case"flash":t="flash_"}return t},getInlineType:function(e){var t="";switch(e.toLowerCase()){case"youtubevideo":t="YouTubeVideo";break;case"image":t="Image";break;case"audiovideo":case"flash":t="Media";break;case"widget":t="Widget"}return t},createCKElement:function(e){var t=this.getCurrentEditor();return t?t.document.createElement(e):null},insertInline:function(e,t){if(e){var i,n=this.getCurrentEditor(),a=this.getPropertyPrefix(e),r=this.getInlineType(e),e=[t[a+"controls"]&&"true"===t[a+"controls"].toLowerCase()?"controls":"",t[a+"autoplay"]&&"true"===t[a+"autoplay"].toLowerCase()?"autoplay":"",t[a+"loop"]&&"true"===t[a+"loop"].toLowerCase()?"loop":""],r='<video height="'+t[a+"height"]+'" width="'+t[a+"width"]+'" '+e.join(" ")+' type="'+r+'">';if(r+='<source src="'+t[a+"url"]+'" type="'+t[a+"mimetype"]+'">',r+="</video>",t.img_link){try{CMSPlugin.restoreFocus(n);var l,o=n.getSelection();o.getType()!=CKEDITOR.SELECTION_ELEMENT||(l=o.getSelectedElement()).is("a")&&(s=l);o=o.getRanges(!0)[0];o.shrink(CKEDITOR.SHRINK_TEXT);var s=o.getCommonAncestor().getAscendant("a",!0)}catch(e){}r=s?(i=[],(a={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"})["data-cke-saved-href"]=t.img_link,t.img_target?a.target=t.img_target:i.push("target"),s.setAttributes(a),s.removeAttributes(i),s.setHtml(r),s.getOuterHtml()):(i='<a href="'+t.img_link+'" ',t.img_target&&(i+='target="'+t.img_target+'" '),(i+=">")+r+"</a>")}else n.document.$.execCommand("unlink",!1,null);this.insertHtml(r)}},insertLink:function(e){var t,i,n,a={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},r=[],l=this.getCurrentEditor(),o=null,s=null,u=null,c=null;try{CMSPlugin.restoreFocus(l),(d=l.getSelection()).getType()!=CKEDITOR.SELECTION_ELEMENT||(t=d.getSelectedElement()).is("a")&&(o=t),(h=d.getRanges(!0)[0]).shrink(CKEDITOR.SHRINK_TEXT);o=h.getCommonAncestor().getAscendant("a",!0)}catch(e){}if(e.link_url?(i=e.link_protocol||"",n=e.link_url||"",a["data-cke-saved-href"]=0===n.indexOf("/")?n:i+n):e.anchor_name?(s=e.anchor_name||"",u=e.anchor_custom||"",c=e.anchor_id||"",a["data-cke-saved-href"]="#"+(s||u||c||"")):e.email_to&&(i=e.email_cc,n=e.email_bcc,s=e.email_subject,u=e.email_body,c=[],i&&c.push("cc="+i),n&&c.push("bcc="+n),s&&c.push("subject="+s),u&&c.push("body="+u),c=c.length?"?"+c.join("&"):"",a["data-cke-saved-href"]="mailto:"+e.email_to+c),e.link_target?a.target=e.link_target:r.push("target"),e.link_url&&((m=function(e,t,i){t=e[t];t?a[i]=t:r.push(i)})(e,"link_url","href"),m(e,"link_id","id"),m(e,"link_target","target"),m(e,"link_class","class"),m(e,"link_tooltip","title"),m(e,"link_style","style"),e.link_name?(a.name=a["data-cke-saved-name"]=e.link_name,a.class=(a.class?a.class+" ":"")+"cke_anchor"):r=r.concat(["data-cke-saved-name","name"])),o){var g=o;g.setAttributes(a),g.removeAttributes(r),g.getAttribute("name")?g.addClass("cke_anchor"):g.removeClass("cke_anchor"),this.fakeObj&&l.createFakeElement(g,"cke_anchor","anchor").replace(this.fakeObj),delete o}else{var d=l.getSelection(),m=d.getRanges(!0),h=m[0];if(1==m.length&&h.collapsed&&(g=new CKEDITOR.dom.text(e.email_linktext||e.email_to||e.anchor_linktext||e.anchor_name||e.link_text||e.link_url,l.document),m[0].insertNode(g),m[0].selectNodeContents(g),d.selectRanges(m)),(m=new CKEDITOR.style({element:"a",attributes:a})).type=CKEDITOR.STYLE_INLINE,m.applyToRange(h),e.link_id)for(var p=l.document.$.getElementsByTagName("a"),f=0;f<p.length;f++)if(p[f].getAttribute("href")==a.href){p[f].id=e.link_id;break}}},insertImage:function(e){var t,i,n=this.createCKElement("img");if(null!=n){if(e.img_id&&(n.$.id=e.img_id),e.img_url&&(n.$.src=e.img_url,n.$.setAttribute("data-cke-saved-src",e.img_url)),e.img_alt?n.$.alt=e.img_alt:e.img_tooltip?n.$.alt=e.img_tooltip:n.$.alt="",e.img_tooltip&&(n.$.title=e.img_tooltip),e.img_class&&n.$.setAttribute("class",e.img_class),e.img_dir&&(n.$.dir=e.img_dir),e.img_usemap&&(n.$.useMap=e.img_usemap),e.img_longdescription&&n.$.setAttribute("longdesc",e.img_longdescription),e.img_lang&&(n.$.lang=e.img_lang),e.img_style&&(n.setAttribute("style",e.img_style),null!=n.$.style.cssStyle&&(n.$.style.cssStyle=e.img_style),null!=n.$.style.cssText&&(n.$.style.cssText=e.img_style)),e.img_width&&0<=parseInt(e.img_width,10)&&(n.$.style.width=parseInt(e.img_width,10)+"px"),e.img_height&&0<=parseInt(e.img_height,10)&&(n.$.style.height=parseInt(e.img_height,10)+"px"),e.img_borderwidth&&0<=parseInt(e.img_borderwidth,10)&&(n.$.style.borderWidth=e.img_borderwidth+"px",n.$.style.borderStyle="solid"),e.img_bordercolor)try{n.$.style.borderColor=e.img_bordercolor}catch(e){n.$.style.borderColor=""}e.img_align&&("left"==e.img_align||"right"==e.img_align?(null!=n.$.style.cssFloat&&(n.$.style.cssFloat=e.img_align),null!=n.$.style.styleFloat&&(n.$.style.styleFloat=e.img_align)):(null!=n.$.style.verticalAlign&&(n.$.style.verticalAlign=e.img_align),null!=n.$.style["vartical-align"]&&(n.$.style["vartical-align"]=e.img_align))),(e.img_vspace||e.img_hspace)&&((t=parseInt(e.img_vspace,10))==(i=parseInt(e.img_hspace,10))&&0<=t?n.$.style.margin=i+"px":t==i&&-1==t||(n.$.style.margin=(0<=t?t+"px ":"auto ")+(0<=i?i+"px":"auto"))),e.img_link||e.img_behavior?(i=this.createCKElement("a"),e.img_link&&(i.$.href=e.img_link,i.$.setAttribute("data-cke-saved-href",e.img_link)),e.img_target?i.$.setAttribute("target",e.img_target):e.img_behavior&&i.$.setAttribute("target",e.img_behavior),i.append(n),this.insertElement(i)):this.insertElement(n)}},insertHtml:function(e){var t=this.getCurrentEditor();t&&(CMSPlugin.restoreFocus(t),t.insertHtml(e))},insertElement:function(e){var t=this.getCurrentEditor();t&&(CMSPlugin.restoreFocus(t),t.insertElement(e))},insert:function(e){var t;e&&((t=e.cms_type)?this.insertInline(t,e):e.link_url||e.email_to||e.anchor_name?this.insertLink(e):e.img_url&&this.insertImage(e))},saveFocus:function(e){CMSPlugin.selection=e.getSelection(),CMSPlugin.selection?(CMSPlugin.selectedElement=CMSPlugin.selection.getSelectedElement(),CMSPlugin.selectionBookmarks=CMSPlugin.selection.createBookmarks2()):(CMSPlugin.selectedElement=null,CMSPlugin.selectionBookmarks=null)},restoreFocus:function(e){CMSPlugin.selection?CMSPlugin.selectionBookmarks?CMSPlugin.selection.selectBookmarks(CMSPlugin.selectionBookmarks):CMSPlugin.selectedElement?CMSPlugin.selection.selectElement(CMSPlugin.selectedElement):e.focus():e.focus()},openModalDialog:function(e,t,i,n,a){window.modalDialog(e,t,i,n,a)},beforeInit:function(e){this.pluginKeyPress(e)},init:function(e){this.initCss(e),this.initMaximalization(e),this.initSelection(e),this.pluginInsertMacro(e),this.pluginInsertImageOrMedia(e),this.pluginInsertLink(e),this.pluginQuicklyInsertMedia(e),this.pluginForumButtons(e)},afterInit:function(e){this.initContextMenu(e),this.initDataProcesor(e),this.initPopupOpener(e)}};CKEDITOR.plugins.add("CMSPlugins",CMSPlugin);